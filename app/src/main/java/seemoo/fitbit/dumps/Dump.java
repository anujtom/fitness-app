package seemoo.fitbit.dumps;


import android.util.Log;

import java.sql.Timestamp;
import java.util.ArrayList;
import java.util.Date;

/**
 * Created by kenny on 26.04.18.
 */

public class Dump {



    ArrayList<MinuteRecord> minuteRecords = new ArrayList<>();
    String demoDump = "2c02000000009a50000085bb0434110707510751000000000000000000001414a60f144800000000f702ff03e2377d091c1f00000000000000ff480020202020202020202020524f434b204f4e2020205343484e454c4c2020204c4f5347454854532020320000000030000000000000000000000000000000000600c0dbdcdd7258df5a080205df5a0078580000007858df5a0b000500000000000000007858df5a0b010500000001000000007858df5a0b020500000020000000007858df5a0b0405ffff00f9ff000000cf58df5a0d00050000000000000000e358df5a1400010000000000000000f058df5a0d00050000000000000000fb58df5a0b0001080000be040000003059df5a1a000500000000000000003e59df5a1a010500000052090000004459df5a0d00050000000000000000a859df5a13ff050000000010000000d759df5a9300010000000000000000f859df5a0d00050000000000000000265adf5a2e00010000000000000000455adf5a0d00050000000000000000685adf5a2300010000000000000000105bdf5a020205000000f90f000000045edf5a0d000500000000000000009062df5a1a000500000000000000006c68df5a13ff05000000ec0f000000587cdf5a13ff05000000e50f0000001097df5a020205000000d80f00000010d3df5a020205000000cf0f000000100fe05a020205000000c60f0000006019e05a1200058070000000000000682fe05a13ff05000000cb0f0000001c3fe05a18e1015e0f005e8e0400008646e05a000002c90f000000000000ab46e05a130505000000c90f000000ab46e05a000003ea0f000000000000b446e05a130505000000ea0f0000001447e05a13ff05ffff00d10f000000104be05a020105000000c60f000000684de05a230005000000d675000000be5be05a13ff05ffff00bb0f000000245ce05a0d00050000000000000000405ee05a1c02010000000000000000ba6ce05a13ff05000000ae0f000000c0c0dbdcdd5adf587c9e0c00ff9e0c00ff9e0c00ff9e1a08ff9e0c00ff9f0c00ff9e0c00ff9e0c00ff9e0c00ff9e0c00ff9e0c00ff9f0c004f9b0a00f19b0a00119b0a00f19b0a0011990a0031990a0011990a0011990a0011990a0011990a0012990a00019d0c00ff9e0c00ff9e0c00ff9f1806ff9f3651ff9f3854ff9b3c5bff9f4063ff9b4062ff9f4264ff9f2222ff9b0a00ff9b0c00ff9b1a0aff9b0a00ff9b1a09ff8b0a00ff9b0a00ff8a0a00ff820a00ff9a2226ff9e2838ff9f201bff8b0a004f830a0012830a0011830a0022820a0011810a0032810a0022810a001f810a00a295201df39e4060ff9e4265ff9f4063ff9b4062ff9b4060ff9f4264ff9f4264ff9f4062ff9f2c43ff9f2222ff9f1802ff9f0c00ff9f0a00ff9f0a00ff9f1e15ff9f3e5fff9f3e5fff9f4061ff9f3c5aff9f3c5bff8718023f830a0023830a0022830a0011820a0011810a0021950c00f29d0a00ff9d0c00ff950c00f69a0c00ff8e0a00ef820a005a820a0011820a0034810a00a2850a00fd950a00bf990a0033990a0011990a0021990a0011990a0010990a0011990a0000990a0010990a0021990a0011990a0011990a0011990a0011990a0010990a0010990a0001990a0011990a0011990a0011990a0021990a0021990a0012990a0011990a0012990a0021990a00129d0a00f1990a0045990a0023990a0011990a0021990a0002990a0022990a0011990a00119d0a00f2810a0012810a0001810a0011810a0011810a0011810a0011810a0011810a0021810a0011810a0011810a0011810a0011810a0023810a0021950c00f19d1a0aff9e2a3cff9e486eff9f466cff9f4870ff9f4870ff9f4871ff9f4264ff8f1c0e4f830a0022830a00118b0c00ff820a0011810a0011810a0011810a0011810a0011810a0011810a0022810a0013810a0011810a0011810a0001810a0013810a0011810a0011810a0011810a0001810a0011810a0021810a0011810a0021810a0011810a0011810a0021810a0011810a0011810a0011810a0012810a0011810a0011950c00f18d0c002f810a0011810a0011810a0012810a0021810a0011810a0011810a0012810a0031810a0023810a0012810a0022810a0011810a0011810a0011810a0011810a0011810a0011810a0011810a0011810a0012810a0011810a0011810a0010810a0011810a0012810a0021810a0021810a0011810a0012810a0021810a0020810a0011810a0011810a0012810a0012810a0000810a0011810a0011810a0000810a0011810a0020810a0031810a0011810a0010810a0001810a0011810a0010810a0001810a0011810a0011810a0011810a0011810a0000810a0011810a0001810a0021810a0000810a0000810a0000810a0010810a0010810a0011810a0010810a0011810a0011810a0011810a0012810a0011810a0012810a0011810a0021810a0012810a0013810a0001810a0001810a0021810a0011810a0021810a0012810a0011810a0021810a0011810a0012810a0021810a0021810a0011810a0011810a0022810a0011810a0011810a0022810a0012810a0012810a0021810a0011810a0011810a0012810a0012810a0012810a0011810a0012810a0011810a0021810a0011810a0012810a0011810a0011810a0011810a0022810a0011810a0011810a0011810a0011810a0012810a0011810a0011810a0012810a0011810a0022810a0022810a0021810a0012810a0011810a0011810a0011810a0011810a0011810a0011810a0011810a0012810a0021810a0011810a0022810a0012810a0031810a0022810a0012810a0011810a0011810a0031810a0021810a0011810a0011810a0022810a0011810a0011810a0011810a0012810a0011810a0021810a0011810a0012810a0011810a0011810a0011810a0022810a0011810a0011810a0011810a0012810a0011810a0012810a0012810a0011810a0021810a0021810a0011810a0011810a0021810a0011810a0012810a0021810a0021810a0011810a0011810a0011810a0032810a0022810a0021810a0011810a00119d0a00ff990a0011990a0021990a0011990a0011990a0011990a0000990a0011990a0011990a0011990a0012990a0011990a0021990a0010990a0001990a0011990a0011990a0011990a0010990a0010990a0001990a0011990a0010990a0011990a0010990a0032990a0011990a0011990a0010990a0011990a0011990a0031990a0011990a0011990a0021990a0012990a0011990a0001990a0011990a0010990a0011990a0010990a0001990a0001990a0001990a0021990a0011990a0001990a0001990a0021990a0011990a0000990a0001990a0010990a0013990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0001990a0011990a0021990a0011990a0011990a0012990a0001990a0011990a0011990a0021990a0011990a0021990a0001990a0011990a0011990a0010990a0011990a0011990a0021990a0011990a0012990a0010990a0011990a0021990a0010990a0011990a0011990a0031990a0021990a0011990a0011990a0011990a0010990a0021990a0011990a0020990a0011990a0011990a0011990a0011990a0011990a0011990a0012990a0011990a0022990a0021990a0021990a0011990a0011990a0011990a0011990a0011990a0012990a0013990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0012990a0012990a0021990a0010990a0011990a0011990a0011990a0010990a0011990a0001990a0001990a0011990a0011990a0011990a0011990a0011990a0011990a0032990a0012990a0011990a0021990a0001990a0001990a0011990a0011990a0001990a0011990a0001990a0020990a0010990a0021990a0010990a0011990a0012990a0000990a0010990a0011990a0011990a0002990a0001990a0011990a0011990a0010990a0021990a0010990a0021990a0010990a0010990a0011990a0000990a0010990a0011990a0011990a0011990a0010990a0011990a0021990a0021990a0011990a0011990a0011990a0014990a0012990a0021990a0012990a0011990a0011990a0012990a0011990a0011990a0011990a0011990a0011990a0022990a0011990a0011990a0021990a0011990a0013990a0011990a0011990a0012990a0012990a0012990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0022990a0021990a0021990a0011990a0022990a0012990a0001990a0023990a0021990a0011990a0011990a0021990a0012990a0012990a0011990a0013990a0021990a0011990a0012990a0022990a0012990a0011990a0001990a0031990a0011990a0021990a0022990a0011990a0011990a0010990a0031990a0012990a0011990a0011990a0031990a0011990a0011990a0011990a0031990a0022990a0011990a0032990a0011990a0012990a0011990a0021990a0011990a0011990a0012990a0021990a0021990a0012990a0011990a0001990a0011990a0012990a0011990a0011990a0011990a0021990a0011990a0010990a0021990a0012990a0012990a0011990a0001990a0021990a0010990a0011990a0011990a0012990a0011990a0011990a0010990a0011990a0021990a0011990a0011990a0011990a0011990a0012990a0011990a0000990a0000990a0011990a0021990a0031990a0012990a0011990a0011990a0011990a0011990a0013990a0022990a0011990a0011990a0011990a0001990a0012990a0011990a0010990a0011990a0011990a0011990a0012990a0012990a0011990a0022990a0031990a0011990a0011990a0011990a0011990a0011990a0012990a0011990a0021990a0011990a0011990a0011990a0011990a0011990a0021990a0010990a0011990a0011990a0011990a0012990a0012990a0012990a0010990a0012990a0011990a0011990a0011990a0021990a0022990a0011990a0011990a0011990a0011990a0021990a0022990a0011990a0011990a0011990a0011990a0011990a0011990a0001990a0011990a0022990a0011990a0011990a0021990a0013990a0012990a0011990a0011990a0011990a0011990a0011990a0011990a0020990a0023990a0011990a0011990a0011990a0011990a0012990a0012990a0012990a0011990a0011990a0012990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0010990a0011990a0011990a0001990a0011990a0011990a0011990a0011990a0021990a0011990a0011990a0011990a0001990a0011990a0011990a0011990a0022990a0010990a0021990a0021990a0012990a0011990a0001990a0011990a0011990a0001990a0011990a0011990a0011990a0011990a0011990a0011990a0012990a0001990a0001990a0001990a0011990a0011990a0011990a0021990a0002990a0011990a0000990a0011990a0010990a0001990a0011990a0011990a0012990a0001990a0010990a0011990a0011990a0011990a0021990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0012990a0011990a0011990a0011990a0017990a0013990a0011990a0064990a0015990a0011990a0001990a0021990a0010990a0001990a0010990a0001990a0001990a0000990a0000990a0001990a0010990a0000990a0000990a0011990a0090990a0012990a0021990a0011990a0011990a0013990a0011990a0021990a0013990a0012990a0011990a0011990a0011990a0011990a0011990a0011990a0010990a0001990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0011990a0012990a0011990a0012990a0020990a0011990a0012990a0011990a0000990a0011990c00f19d1a08ff9d2020ff9e3c5bff9f486eff9b3e5eff9b0a00ff9b0a00ff9b0c00ff9b1c0fff9f1a09ff830a00ff9b0c00ff830a00ff9b0c00ff9a1a07ff9b0c00ff830a00ff930c00ff8b0c00ff8f0a00ff830a00df970a00ff9f0c00ff9b446aff9f4468ff9f4063ff9f3c5aff9f344cff9f344bff9b2c43ff9b0a00af9f0a00ff9f201fff9f2225ff8f0c005f830a001f830a0021830a0012820a0011810a0011810a0012810a0011810a0012810a0021810a0012810a0021810a0012810a0012810a0011810a0011810a0012810a0012810a0021810a0011810a0021810a0012810a0011810a0022810a0013810a0021810a0012810a0012810a0012810a0011810a0021810a0022810a0051810a0012810a0011810a0021810a0021810a00219d0c00ff9e0a0011990a0011990a00f1990a00fb990a001d990a0011990a0001990a0001990a0001990a0010990a0011990a0011990a0000990a0010990a0011990a0010990c00f0990a0021990a006b990a00109a0a0010990a0021990a0011990a0012990a0010990a0010990a0011990a0001990a00009d1806ff9d0c00ff8e0c00ff9e0c00ff9b0a00119f0c00ff9f0c00ff9e0c00ff9e0c00f1971c12f19f3855ff830a00ff830a00ff930a00ff9b201aff960a00ff9e1e18ff920a00ff970a00ff8f0a00ff971e14ff8e0c00ff820a0011820a0011820a0001810a0011810a0011810a0011810a0011810a0011810a0020810a0021810a0011810a0021810a0002810a00119d0c00ff9d2c44ff9e1c0fff9f4c77ff9f4468ff9f4467ff9f4467ff9f4062ff9f4063ff9f1805ff930a00ff9b0a00ff9b0c00ff8b0c00ff8b0a00ff930c00ff8b0a00ff930a00ff9b0a00ff9b0a00ff9f262fff9f466dff9f466cff9f242bff8b0a002f830a0011830a0010830a0021820a0011810a0011810a0011810a0011810a0021810a0011810a0011810a0011810a0011810a0011810a0011810a0021810a0011810a0011810a0011810a0012810a0011810a0011810a0011810a0011810a00119d0c00ff9d0a000f990a0011990a00419a0a00ff990c00f09d0c001f990a0021990a00119a0a00f19e0a00f19d0a000f9d0c00f5990a00229a0a00129a0a00119d0c00ff990a005f9e0c00fd9d0a00ff990a006d990a0089990a006d990a008f990a009d990a00d9990a00f7990a0075990a00cf990a00ef990a008f990a009e990a00ff990a00f7990a00f9990a00df9d0c007f990a00f6990a004e990a00a69a0a00ff990a00b9990a009f990a0067990a00f6990a00ff990a00ff990a007b990a004f990a00f69a0a006a990a008f990a006b990a007f990a0069990a006f9d1a09ff9e0c00ff9e0a00ff9e0c00ff9b0a007f9b0a00219b0a00f39b0a0075990a0011990a001f990a00f3990a00d4990a0050990a0082990a0055990a0034990a0013990a0033990a00f3990a001f990a0099990a0010990a00f0990a00ff9d0c009f990a00ff990a0011990a0011990a0001990a0011990a002f990a0011990a0011990a00119d0c00ff990a00ff990a00ff9a0a00ff9a0a00ff9e0c00ffc0c0dbdcddc0c0dbdcdde0a8df5a8443f7100000514c320000001e000000ac5ee05ade23cb080000dd111a0000000f0000006c62e05a7e24cb080000dd111a0000000f000000da62e05a9424cb080000dd111a0000000f000000e264e05aee24cb080000dd111a0000000f000000666de05a6c26d40800008c2c1a0000000f0000006870e05af226d40800008c2c1a0000000f000000c000000000c0dbdcddd00101001c0201000dfc0fdbdcfc0fdbdcffffdbdcfc0fdbdcfc0000300b01001c0201000dfc0fdbdcfc0fdbdcffffdbdcfc0fdb04341100000000000000000000000000000000";
    protected final String TAG = this.getClass().getSimpleName();

    public Dump(String plaintext) {
        parseMinuteRecords(plaintext);
    }


    public ArrayList<MinuteRecord> getMinuteRecords() {
        return minuteRecords;
    }

    private void parseMinuteRecords(String dumpPlaintext) {

        if(dumpPlaintext.split("c0c0dbdcdd").length>=2){

            String minuteRecordText = dumpPlaintext.split("c0c0dbdcdd")[1];


            String timestampStr = minuteRecordText.substring(0, 8);

            minuteRecordText = minuteRecordText.substring(8, minuteRecordText.length());


            Timestamp initialTimestamp = new Timestamp(Long.parseLong(timestampStr, 16));
            Date date = new Date(initialTimestamp.getTime() * 1000L);



            for (int j = 0; j < minuteRecordText.length(); j = j + 8) {

                String record = minuteRecordText.substring(j, j + 8);
                String stepsStr = record.substring(4, 6);


                int steps = Integer.parseInt(stepsStr, 16);

                //System.out.println(date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds() + "Steps: " + steps);
                date = new Date(date.getTime() + 60000);
                minuteRecords.add(new MinuteRecord(new Timestamp(date.getTime()),steps));

            }

        } else {
            Log.i(TAG, "Problems during dump parsing: No MinuteRecords found.");
        }

    }


}
